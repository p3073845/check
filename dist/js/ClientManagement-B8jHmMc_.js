import{u as U,b as E,r as n,m as c,f as b,d as V,y as m,e as Q,c as q,j as e,P as L,g as z,L as H,h as Z,D as B,C as G,i as J,E as K}from"../assets/index-DFJJ7hfU.js";const X=()=>{var I,P,_,v,y,S;const d=U(),{loading:k,loadingStatusUpdates:f}=E(s=>s.user),i=E(s=>s.user.users),C=n.useRef(!1),[o,N]=n.useState({showDeleteModal:!1,deleteId:null,showPasswordModal:!1,passwordClientId:null,showEditModal:!1,editClientId:null}),[r,w]=n.useState({searchQuery:"",from_date:c().startOf("month"),to_date:c(),currentPage:1,limit:10});console.log(r,"filters");const u=n.useCallback((s={})=>{const{from_date:a,to_date:t,searchQuery:l,currentPage:x,limit:j}=r;return{limit:j,page:x,search:l,from_date:c(s.from_date||a).startOf("day").unix().toString(),to_date:c(s.to_date||t).endOf("day").unix().toString(),...s}},[r]),g=n.useCallback(()=>{d(b(u()))},[d,u]);n.useEffect(()=>{C.current||(g(),C.current=!0)},[g]);const M=s=>{const a=s.target.value;a.length>=2||a.length===0?(w(t=>({...t,searchQuery:a,currentPage:1})),d(b(u({search:a,page:1})))):w(t=>({...t,searchQuery:a}))},A=n.useCallback((s,a)=>{const t=s||c().startOf("month"),l=a||c();console.log(t,l),w(x=>({...x,from_date:t,to_date:l,currentPage:1})),d(b(u({from_date:(t?c(t).startOf("day").unix():c().startOf("month").unix()).toString(),to_date:(l?c(l).endOf("day").unix():c().endOf("day").unix()).toString(),page:1})))},[d,u]),$=s=>{w(a=>({...a,currentPage:s})),d(b(u({page:s})))},p=n.useCallback((s,a=null)=>{N(t=>({...t,[`show${s}Modal`]:!0,passwordClientId:s==="Password"?a:t.passwordClientId,deleteId:s==="Delete"?a:t.deleteId,editClientId:s==="Edit"?a:t.editClientId}))},[]),h=n.useCallback(s=>{N(a=>({...a,[`show${s}Modal`]:!1,passwordClientId:s==="Password"?null:a.passwordClientId,deleteId:s==="Delete"?null:a.deleteId,editClientId:s==="Edit"?null:a.editClientId}))},[]),D=n.useCallback(()=>{const s=o.deleteId;s&&d(V({user_id:{user_id:s}})).unwrap().then(a=>{a.error===!1&&(m.success(a.message,{toastId:`user-delete-success-${a.message}`}),g())}).catch(a=>{m.error(a.message||"Failed to delete user",{toastId:`user-delete-error-${a.message}`})}).finally(()=>h("Delete"))},[d,o.deleteId,g,h]),F=s=>{var t,l,x;const a=[{isValid:(t=s.name)==null?void 0:t.trim(),message:"Please enter a Client Name",id:"client-name-required"},{isValid:((l=s.name)==null?void 0:l.length)>=2,message:"Client Name should be at least 2 characters long",id:"client-name-length"},{isValid:/^[a-zA-Z ]{2,}$/.test(s.name),message:"Please enter a valid Client Name without special characters and numbers",id:"client-name-invalid"},{isValid:(x=s.email)==null?void 0:x.trim(),message:"Please enter an email address",id:"client-email-required"},{isValid:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email),message:"Please enter a valid email address",id:"client-email-invalid"},{isValid:s.status,message:"Please select a status",id:"client-status-required"}];for(const j of a)if(!j.isValid)return m.error(j.message,{toastId:j.id}),!1;return!0},O=n.useCallback(s=>{if(!F(s))return;const a={user_id:s.user_id,name:s.name.trim(),email:s.email.trim(),status:s.status};d(Q({payload:a})).unwrap().then(t=>{if(!t.error&&t.code===0)m.success(t.message,{toastId:`edit-client-success-${s.user_id}`}),g(),h("Edit");else throw new Error(t.message)}).catch(t=>{m.error(t.message||"Failed to edit client",{toastId:`edit-client-error-${s.user_id}`})})},[d,g,h]),R=n.useCallback((s,a)=>{d(q({payload:{id:s,status:a==="1"?"0":"1"}})).unwrap().then(l=>{l.error===!1&&m.success(l.message,{toastId:`status-update-success-${s}`})}).catch(l=>{m.error(l.message||"Failed to update status",{toastId:`status-update-error-${s}`})})},[d]);return e.jsxs("div",{children:[e.jsx(L,{}),e.jsxs("div",{className:"main_card",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-4 col-md-6 col-sm-6",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"dateRange",children:"Date Range"}),e.jsx(z,{id:"dateRange",startDate:r.from_date,endDate:r.to_date,onDateSelect:A})]})}),e.jsx("div",{className:"col-lg-4 col-md-6 col-sm-6",children:e.jsxs("div",{className:"app-search-box",children:[e.jsx("label",{htmlFor:"dateRange",children:"Search"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by name or email...",value:r.searchQuery,name:"searchQuery",onChange:M,"aria-label":"Search clients"}),e.jsx("div",{className:"input-group-append",children:e.jsx("button",{className:"btn",type:"submit",children:e.jsx("i",{className:"fas fa-search"})})})]})]})}),e.jsx("div",{className:"col-lg-4 col-md-12  col-sm-12 addclient  mb-3",children:e.jsxs(H,{to:"/add-client",className:"btn btn-color waves-effect waves-light",title:"Add New Client",children:[e.jsx("i",{className:"fas fa-plus-square me-2"}),e.jsx("span",{className:"ml-2",children:"Add New Client"})]})})]}),e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-lg-12",children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Client Name"}),e.jsx("th",{children:"Email Id"}),e.jsx("th",{children:"Create Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:k?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"",style:{height:"60vh"},children:e.jsx("div",{className:"table_loader",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})})})})}):e.jsx(e.Fragment,{children:((P=(I=i==null?void 0:i.data)==null?void 0:I.user_list)==null?void 0:P.length)>0?(v=(_=i==null?void 0:i.data)==null?void 0:_.user_list)==null?void 0:v.map((s,a)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:(r.currentPage-1)*r.limit+a+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.declared_date}),e.jsx("td",{children:e.jsxs("label",{className:`switch custom_switch ${f[s.id]?"disabled":""}`,style:{opacity:f[s.id]?.5:1,cursor:f[s.id]?"not-allowed":"pointer"},children:[e.jsx("input",{type:"checkbox",defaultChecked:s.status==="1",onChange:()=>R(s.id,s.status),disabled:f[s.id]}),e.jsx("span",{className:"slider round"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"Actionbtn_table",children:[e.jsx("button",{className:"btn waves-effect waves-light btn-purple",title:"Edit",onClick:()=>p("Edit",s.id),children:e.jsx("i",{className:"mdi mdi-account-edit-outline"})}),e.jsx("button",{type:"button",className:"btn waves-effect waves-light btn-danger",title:"Delete",onClick:()=>p("Delete",s.id),children:e.jsx("i",{className:"mdi mdi-delete-alert"})}),e.jsx("button",{type:"button",className:"btn waves-effect waves-light btn-success change_password",title:"Change Password",style:{padding:"0px 11px 0px 10px"},onClick:()=>p("Password",s.id),children:e.jsx("i",{className:"ion ion-md-unlock"})})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center",children:"No clients found..."})})})})]})}),e.jsx(Z,{currentPage:r.currentPage,totalItems:((y=i==null?void 0:i.data)==null?void 0:y.total_count)||0,itemsPerPage:r.limit,onPageChange:$})]})})]}),e.jsx(B,{show:o.showDeleteModal,onConfirm:D,onCancel:()=>h("Delete")}),e.jsx(G,{show:o.showPasswordModal,onClose:()=>h("Password"),clientId:o.passwordClientId,apiAction:J}),e.jsx(K,{show:o.showEditModal,onClose:()=>h("Edit"),clientId:o.editClientId,onEdit:O,userData:(S=i==null?void 0:i.data)==null?void 0:S.user_list,modalType:"Client"})]})};export{X as default};
